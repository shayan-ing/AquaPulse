const translations = {
    en: {
      appTitle: "AquaPulse",
      communityImpact: "Community Impact",
      savedThisMonth: "Saved This Month!",
      leakLocations: "Leak Locations",
      quickActions: "Quick Actions",
      reportLeak: "Report Leak",
      verifyLeaks: "Verify Leaks",
      viewLeaderboard: "Leaderboard",
      viewRiskMap: "Risk Mapping",
      conservationTip: "Weekly Conservation Tip",
      tipContent: "Fix dripping faucets to save up to 15L per day!",
      reportLeakTitle: "Report a Leak",
      describeLeak: "Describe the leak",
      addPhoto: "Add Photo",
      addVideo: "Add Video",
      voiceInput: "Voice Input",
      location: "Location",
      anonymousReport: "Report Anonymously",
      submitReport: "Submit Report",
      severity: "Severity: Minor",
      offlineWarning: "Report will sync when online.",
      verifyLeakTitle: "Verify a Leak",
      reported: "Reported",
      description: "Description",
      distance: "Distance",
      status: "Status",
      photoPreview: "Photo Preview",
      verificationProgress: "Verification Progress",
      confirmLeak: "Confirm Leak",
      markFalse: "Mark as False",
      comments: "Additional comments",
      officialVerified: "Official Verified",
      leaderboardTitle: "Leaderboard & Rewards",
      topReporters: "Top Reporters",
      badges: "Badges",
      aquaHero: "Aqua Hero",
      firstReport: "First Report",
      treeSapling: "Tree Sapling",
      waterKit: "Water Kit",
      redeemNow: "Redeem Now",
      shareAchievement: "Share Achievement",
      riskMapTitle: "Risk Mapping",
      statsOverview: "Statistics Overview",
      highRiskZones: "High-Risk Zones",
      nextLikely: "Next Likely (Location)",
      recentAlerts: "Recent Alerts",
      additionalFilters: "Additional Filters",
      verified: "Verified",
      unverified: "Unverified",
      downloadReport: "Download Report",
      profileTitle: "User Profile",
      yourImpact: "Your Impact",
      waterSaved: "Water Saved",
      pointsEarned: "Points Earned",
      editProfile: "Edit Profile",
      aboutMe: "About Me",
      preferencesStats: "Preferences & Stats",
      preferredLanguage: "Preferred Language",
      favoriteTip: "Favorite Tip",
      logout: "Logout",
      home: "Home",
      reports: "Reports",
      contact: "Contact",
      contactSupport: "Contact Support",
      followUs: "Follow Us",
      sendMessage: "Send Us a Message",
      yourName: "Your Name",
      yourEmail: "Your Email",
      yourMessage: "Your Message",
      submit: "Submit",
      settings: "Settings",
      accountSettings: "Account Settings",
      emailNotifications: "Email Notifications",
      pushNotifications: "Push Notifications",
      appPreferences: "App Preferences",
      language: "Language",
      theme: "Theme",
      dataUsage: "Data Usage",
      lowBandwidthMode: "Low Bandwidth Mode",
      save: "Save",
      back: "Back",
      locationAccessDenied: "Location access denied.",
      voiceInputError: "Voice input failed.",
      voiceInputNotSupported: "Voice input not supported in this browser.",
      imageUploaded: "Image uploaded successfully!",
      imageCompressionError: "Failed to compress image.",
      reportSubmitted: "Report submitted!",
      leakConfirmed: "Leak confirmed!",
      leakMarkedFalse: "Leak marked as false!",
      nearbyLeak: "Nearby Leak Detected!",
      leakNearbyBody: "A leak was reported 100m away at Lat: {lat}, Lon: {lng}. Verify now!",
      messageSent: "Message sent successfully!",
      settingsSaved: "Settings saved successfully!",
      profileSaved: "Profile updated successfully!"
    },
    hi: {
      appTitle: "à¤à¤•à¥à¤µà¤¾à¤ªà¤²à¥à¤¸",
      communityImpact: "à¤¸à¤®à¥à¤¦à¤¾à¤¯ à¤ªà¥à¤°à¤­à¤¾à¤µ",
      savedThisMonth: "à¤‡à¤¸ à¤®à¤¹à¥€à¤¨à¥‡ à¤¬à¤šà¤¾à¤¯à¤¾ à¤—à¤¯à¤¾!",
      leakLocations: "à¤°à¤¿à¤¸à¤¾à¤µ à¤¸à¥à¤¥à¤¾à¤¨",
      quickActions: "à¤¤à¥à¤µà¤°à¤¿à¤¤ à¤•à¤¾à¤°à¥à¤°à¤µà¤¾à¤ˆ",
      reportLeak: "à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¥€ à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤•à¤°à¥‡à¤‚",
      verifyLeaks: "à¤¨à¤œà¤¦à¥€à¤•à¥€ à¤°à¤¿à¤¸à¤¾à¤µ à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
      viewLeaderboard: "à¤²à¥€à¤¡à¤°à¤¬à¥‹à¤°à¥à¤¡ à¤¦à¥‡à¤–à¥‡à¤‚",
      viewRiskMap: "à¤œà¥‹à¤–à¤¿à¤® à¤¨à¤•à¥à¤¶à¤¾",
      conservationTip: "à¤¸à¤¾à¤ªà¥à¤¤à¤¾à¤¹à¤¿à¤• à¤¸à¤‚à¤°à¤•à¥à¤·à¤£ à¤¸à¥à¤à¤¾à¤µ",
      tipContent: "à¤Ÿà¤ªà¤•à¤¤à¥‡ à¤¨à¤² à¤•à¥‹ à¤ à¥€à¤• à¤•à¤°à¥‡à¤‚, à¤ªà¥à¤°à¤¤à¤¿à¤¦à¤¿à¤¨ 15 à¤²à¥€à¤Ÿà¤° à¤¤à¤• à¤¬à¤šà¤¾à¤à¤‚!",
      reportLeakTitle: "à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¥€ à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤•à¤°à¥‡à¤‚",
      describeLeak: "à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¤¾ à¤µà¤°à¥à¤£à¤¨ à¤•à¤°à¥‡à¤‚",
      addPhoto: "à¤«à¥‹à¤Ÿà¥‹ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
      addVideo: "à¤µà¥€à¤¡à¤¿à¤¯à¥‹ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",
      voiceInput: "à¤†à¤µà¤¾à¤œ à¤‡à¤¨à¤ªà¥à¤Ÿ",
      location: "à¤¸à¥à¤¥à¤¾à¤¨",
      anonymousReport: "à¤…à¤¨à¤¾à¤® à¤°à¥‚à¤ª à¤¸à¥‡ à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤•à¤°à¥‡à¤‚",
      submitReport: "à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¤°à¥‡à¤‚",
      severity: "à¤—à¤‚à¤­à¥€à¤°à¤¤à¤¾: à¤®à¤¾à¤®à¥‚à¤²à¥€",
      offlineWarning: "à¤‘à¤«à¤¼à¤²à¤¾à¤‡à¤¨? à¤‘à¤¨à¤²à¤¾à¤‡à¤¨ à¤¹à¥‹à¤¨à¥‡ à¤ªà¤° à¤¸à¤¿à¤‚à¤• à¤¹à¥‹à¤—à¤¾à¥¤",
      verifyLeakTitle: "à¤°à¤¿à¤¸à¤¾à¤µ à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
      reported: "à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾",
      description: "à¤µà¤¿à¤µà¤°à¤£",
      distance: "à¤¦à¥‚à¤°à¥€",
      status: "à¤¸à¥à¤¥à¤¿à¤¤à¤¿",
      photoPreview: "à¤«à¥‹à¤Ÿà¥‹ à¤ªà¥‚à¤°à¥à¤µà¤¾à¤µà¤²à¥‹à¤•à¤¨",
      verificationProgress: "à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¨ à¤ªà¥à¤°à¤—à¤¤à¤¿",
      confirmLeak: "à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¥€ à¤ªà¥à¤·à¥à¤Ÿà¤¿ à¤•à¤°à¥‡à¤‚",
      markFalse: "à¤—à¤²à¤¤ à¤•à¥‡ à¤°à¥‚à¤ª à¤®à¥‡à¤‚ à¤šà¤¿à¤¹à¥à¤¨à¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
      comments: "à¤…à¤¤à¤¿à¤°à¤¿à¤•à¥à¤¤ à¤Ÿà¤¿à¤ªà¥à¤ªà¤£à¤¿à¤¯à¤¾à¤",
      officialVerified: "à¤†à¤§à¤¿à¤•à¤¾à¤°à¤¿à¤• à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤",
      leaderboardTitle: "à¤²à¥€à¤¡à¤°à¤¬à¥‹à¤°à¥à¤¡ à¤”à¤° à¤ªà¥à¤°à¤¸à¥à¤•à¤¾à¤°",
      topReporters: "à¤¶à¥€à¤°à¥à¤· à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿà¤°",
      badges: "à¤¬à¥ˆà¤œ",
      aquaHero: "à¤à¤•à¥à¤µà¤¾ à¤¹à¥€à¤°à¥‹",
      firstReport: "à¤ªà¤¹à¤²à¥€ à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ",
      treeSapling: "à¤ªà¥Œà¤§à¤¾",
      waterKit: "à¤ªà¤¾à¤¨à¥€ à¤•à¤¿à¤Ÿ",
      redeemNow: "à¤…à¤¬ à¤°à¤¿à¤¡à¥€à¤® à¤•à¤°à¥‡à¤‚",
      shareAchievement: "à¤‰à¤ªà¤²à¤¬à¥à¤§à¤¿ à¤¸à¤¾à¤à¤¾ à¤•à¤°à¥‡à¤‚",
      riskMapTitle: "à¤œà¥‹à¤–à¤¿à¤® à¤¨à¤•à¥à¤¶à¤¾",
      statsOverview: "à¤¸à¤¾à¤‚à¤–à¥à¤¯à¤¿à¤•à¥€ à¤…à¤µà¤²à¥‹à¤•à¤¨",
      highRiskZones: "à¤‰à¤šà¥à¤š à¤œà¥‹à¤–à¤¿à¤® à¤•à¥à¤·à¥‡à¤¤à¥à¤°",
      nextLikely: "à¤…à¤—à¤²à¤¾ à¤¸à¤‚à¤­à¤¾à¤µà¤¿à¤¤ (à¤¸à¥à¤¥à¤¾à¤¨)",
      recentAlerts: "à¤¹à¤¾à¤² à¤•à¥‡ à¤…à¤²à¤°à¥à¤Ÿ",
      additionalFilters: "à¤…à¤¤à¤¿à¤°à¤¿à¤•à¥à¤¤ à¤«à¤¼à¤¿à¤²à¥à¤Ÿà¤°",
      verified: "à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤",
      unverified: "à¤…à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤",
      downloadReport: "à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤¡à¤¾à¤‰à¤¨à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚",
      profileTitle: "à¤‰à¤ªà¤¯à¥‹à¤—à¤•à¤°à¥à¤¤à¤¾ à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤²",
      yourImpact: "à¤†à¤ªà¤•à¤¾ à¤ªà¥à¤°à¤­à¤¾à¤µ",
      waterSaved: "à¤ªà¤¾à¤¨à¥€ à¤¬à¤šà¤¾à¤¯à¤¾",
      pointsEarned: "à¤ªà¥‰à¤‡à¤‚à¤Ÿà¥à¤¸ à¤…à¤°à¥à¤œà¤¿à¤¤",
      editProfile: "à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤¸à¤‚à¤ªà¤¾à¤¦à¤¿à¤¤ à¤•à¤°à¥‡à¤‚",
      aboutMe: "à¤®à¥‡à¤°à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚",
      preferencesStats: "à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾à¤à¤ à¤”à¤° à¤†à¤à¤•à¤¡à¤¼à¥‡",
      preferredLanguage: "à¤ªà¤¸à¤‚à¤¦à¥€à¤¦à¤¾ à¤­à¤¾à¤·à¤¾",
      favoriteTip: "à¤ªà¤¸à¤‚à¤¦à¥€à¤¦à¤¾ à¤¸à¥à¤à¤¾à¤µ",
      logout: "à¤²à¥‰à¤—à¤†à¤‰à¤Ÿ",
      home: "à¤¹à¥‹à¤®",
      reports: "à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿà¥à¤¸",
      contact: "à¤¸à¤‚à¤ªà¤°à¥à¤•",
      contactSupport: "à¤¸à¤¹à¤¾à¤¯à¤¤à¤¾ à¤¸à¥‡ à¤¸à¤‚à¤ªà¤°à¥à¤• à¤•à¤°à¥‡à¤‚",
      followUs: "à¤¹à¤®à¥‡à¤‚ à¤«à¥‰à¤²à¥‹ à¤•à¤°à¥‡à¤‚",
      sendMessage: "à¤¹à¤®à¥‡à¤‚ à¤¸à¤‚à¤¦à¥‡à¤¶ à¤­à¥‡à¤œà¥‡à¤‚",
      yourName: "à¤†à¤ªà¤•à¤¾ à¤¨à¤¾à¤®",
      yourEmail: "à¤†à¤ªà¤•à¤¾ à¤ˆà¤®à¥‡à¤²",
      yourMessage: "à¤†à¤ªà¤•à¤¾ à¤¸à¤‚à¤¦à¥‡à¤¶",
      submit: "à¤œà¤®à¤¾ à¤•à¤°à¥‡à¤‚",
      settings: "à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",
      accountSettings: "à¤–à¤¾à¤¤à¤¾ à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸",
      emailNotifications: "à¤ˆà¤®à¥‡à¤² à¤¸à¥‚à¤šà¤¨à¤¾à¤à¤‚",
      pushNotifications: "à¤ªà¥à¤¶ à¤¸à¥‚à¤šà¤¨à¤¾à¤à¤‚",
      appPreferences: "à¤à¤ª à¤ªà¥à¤°à¤¾à¤¥à¤®à¤¿à¤•à¤¤à¤¾à¤à¤‚",
      language: "à¤­à¤¾à¤·à¤¾",
      theme: "à¤¥à¥€à¤®",
      dataUsage: "à¤¡à¥‡à¤Ÿà¤¾ à¤‰à¤ªà¤¯à¥‹à¤—",
      lowBandwidthMode: "à¤•à¤® à¤¬à¥ˆà¤‚à¤¡à¤µà¤¿à¤¡à¥à¤¥ à¤®à¥‹à¤¡",
      save: "à¤¸à¤¹à¥‡à¤œà¥‡à¤‚",
      back: "à¤µà¤¾à¤ªà¤¸",
      locationAccessDenied: "à¤¸à¥à¤¥à¤¾à¤¨ à¤ªà¤¹à¥à¤‚à¤š à¤…à¤¸à¥à¤µà¥€à¤•à¥ƒà¤¤à¥¤",
      voiceInputError: "à¤†à¤µà¤¾à¤œ à¤‡à¤¨à¤ªà¥à¤Ÿ à¤µà¤¿à¤«à¤²à¥¤",
      voiceInputNotSupported: "à¤‡à¤¸ à¤¬à¥à¤°à¤¾à¤‰à¤œà¤¼à¤° à¤®à¥‡à¤‚ à¤†à¤µà¤¾à¤œ à¤‡à¤¨à¤ªà¥à¤Ÿ à¤¸à¤®à¤°à¥à¤¥à¤¿à¤¤ à¤¨à¤¹à¥€à¤‚ à¤¹à¥ˆà¥¤",
      imageUploaded: "à¤›à¤µà¤¿ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤…à¤ªà¤²à¥‹à¤¡ à¤•à¥€ à¤—à¤ˆ!",
      imageCompressionError: "à¤›à¤µà¤¿ à¤¸à¤‚à¤ªà¥€à¤¡à¤¼à¤¨ à¤µà¤¿à¤«à¤²à¥¤",
      reportSubmitted: "à¤°à¤¿à¤ªà¥‹à¤°à¥à¤Ÿ à¤¸à¤¬à¤®à¤¿à¤Ÿ à¤•à¥€ à¤—à¤ˆ!",
      leakConfirmed: "à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¥€ à¤ªà¥à¤·à¥à¤Ÿà¤¿ à¤•à¥€ à¤—à¤ˆ!",
      leakMarkedFalse: "à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¥‹ à¤—à¤²à¤¤ à¤šà¤¿à¤¹à¥à¤¨à¤¿à¤¤ à¤•à¤¿à¤¯à¤¾ à¤—à¤¯à¤¾!",
      nearbyLeak: "à¤¨à¤œà¤¦à¥€à¤•à¥€ à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¤¾ à¤ªà¤¤à¤¾ à¤šà¤²à¤¾!",
      leakNearbyBody: "100 à¤®à¥€à¤Ÿà¤° à¤¦à¥‚à¤° Lat: {lat}, Lon: {lng} à¤ªà¤° à¤°à¤¿à¤¸à¤¾à¤µ à¤•à¥€ à¤¸à¥‚à¤šà¤¨à¤¾ à¤®à¤¿à¤²à¥€à¥¤ à¤…à¤¬ à¤¸à¤¤à¥à¤¯à¤¾à¤ªà¤¿à¤¤ à¤•à¤°à¥‡à¤‚!",
      messageSent: "à¤¸à¤‚à¤¦à¥‡à¤¶ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤­à¥‡à¤œà¤¾ à¤—à¤¯à¤¾!",
      settingsSaved: "à¤¸à¥‡à¤Ÿà¤¿à¤‚à¤—à¥à¤¸ à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤¸à¤¹à¥‡à¤œà¥€ à¤—à¤ˆà¤‚!",
      profileSaved: "à¤ªà¥à¤°à¥‹à¤«à¤¾à¤‡à¤² à¤¸à¤«à¤²à¤¤à¤¾à¤ªà¥‚à¤°à¥à¤µà¤• à¤…à¤ªà¤¡à¥‡à¤Ÿ à¤•à¥€ à¤—à¤ˆ!"
    }
  };
  
  // Initialize i18next
  i18next.init({
    lng: 'en',
    resources: {
      en: { translation: translations.en },
      hi: { translation: translations.hi }
    }
  }, (err) => {
    if (err) {
      console.error('i18next initialization failed:', err);
      return;
    }
    updateContent();
    updateProfileDisplay();
  });
  
  // Update UI with translations
  function updateContent() {
    try {
      document.querySelectorAll('[data-i18n]').forEach(element => {
        const key = element.getAttribute('data-i18n');
        if (key.startsWith('[placeholder]')) {
          element.placeholder = i18next.t(key.replace('[placeholder]', '')) || element.placeholder;
        } else {
          element.innerHTML = i18next.t(key) || element.innerHTML;
        }
      });
  
      // Sync language selectors
      const currentLang = i18next.language || 'en';
      document.getElementById('language').value = currentLang;
      document.getElementById('settings-language').value = currentLang;
      document.getElementById('report-language').value = currentLang;
  
      // Sync theme selector
      const currentTheme = document.body.getAttribute('data-theme') || 'light';
      document.getElementById('settings-theme').value = currentTheme;
      document.getElementById('theme-toggle').textContent = currentTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
    } catch (error) {
      console.error('Error updating content:', error);
    }
  }
  
  // Theme Toggle
  function toggleTheme() {
    try {
      const currentTheme = document.body.getAttribute('data-theme') || 'light';
      const newTheme = currentTheme === 'light' ? 'dark' : 'light';
      document.body.setAttribute('data-theme', newTheme);
      localStorage.setItem('theme', newTheme);
      document.getElementById('theme-toggle').textContent = newTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
      document.getElementById('settings-theme').value = newTheme;
      updateContent();
    } catch (error) {
      console.error('Error toggling theme:', error);
    }
  }
  
  // Apply saved theme
  function applySavedTheme() {
    const savedTheme = localStorage.getItem('theme') || 'light';
    document.body.setAttribute('data-theme', savedTheme);
    document.getElementById('theme-toggle').textContent = savedTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
    document.getElementById('settings-theme').value = savedTheme;
  }
  
  // Language Change
  function changeLanguage(lang) {
    try {
      i18next.changeLanguage(lang, (err) => {
        if (err) {
          console.error('Language change failed:', err);
          return;
        }
        updateContent();
      });
    } catch (error) {
      console.error('Error changing language:', error);
    }
  }
  
  // Event Listeners for Language and Theme
  document.getElementById('language').addEventListener('change', (e) => {
    changeLanguage(e.target.value);
  });
  
  document.getElementById('settings-language').addEventListener('change', (e) => {
    changeLanguage(e.target.value);
  });
  
  document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
  
  document.getElementById('settings-theme').addEventListener('change', (e) => {
    const newTheme = e.target.value;
    document.body.setAttribute('data-theme', newTheme);
    localStorage.setItem('theme', newTheme);
    document.getElementById('theme-toggle').textContent = newTheme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
    updateContent();
  });
  
  // Bandwidth Mode
  function setBandwidthMode() {
    const lowBandwidth = document.getElementById('low-bandwidth-mode').checked;
    document.body.setAttribute('data-bandwidth', lowBandwidth ? 'low' : 'normal');
    localStorage.setItem('bandwidth', lowBandwidth ? 'low' : 'normal');
  }
  
  // Apply saved bandwidth mode
  const savedBandwidth = localStorage.getItem('bandwidth') || 'normal';
  document.body.setAttribute('data-bandwidth', savedBandwidth);
  document.getElementById('low-bandwidth-mode').checked = savedBandwidth === 'low';
  
  // Screen Navigation
  function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
      screen.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
  }
  
  // Initialize Maps
  let homeMap, verifyMap, riskMap;
  function initMaps() {
    try {
      homeMap = L.map('map').setView([51.505, -0.09], 13);
      verifyMap = L.map('verify-map').setView([51.505, -0.09], 13);
      riskMap = L.map('risk-map-container').setView([51.505, -0.09], 13);
  
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
      }).addTo(homeMap);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
      }).addTo(verifyMap);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
      }).addTo(riskMap);
  
      L.marker([51.5, -0.09]).addTo(homeMap).bindPopup('Sample Leak Location').openPopup();
      L.marker([51.5, -0.09]).addTo(verifyMap).bindPopup('Leak to Verify').openPopup();
      L.marker([51.5, -0.09]).addTo(riskMap).bindPopup('High Risk Zone').openPopup();
    } catch (error) {
      console.error('Error initializing maps:', error);
    }
  }
  
  // Get User Location
  function getUserLocation(callback) {
    if (navigator.geolocation) {
      navigator.geolocation.getCurrentPosition(
        (position) => {
          const { latitude, longitude } = position.coords;
          callback({ lat: latitude, lng: longitude });
        },
        () => {
          alert(i18next.t('locationAccessDenied'));
          callback(null);
        }
      );
    } else {
      alert(i18next.t('locationAccessDenied'));
      callback(null);
    }
  }
  
  // Report Form Submission
  document.getElementById('report-form').addEventListener('submit', (e) => {
    e.preventDefault();
    getUserLocation((coords) => {
      if (coords) {
        document.getElementById('location').value = `Lat: ${coords.lat}, Lon: ${coords.lng}`;
        alert(i18next.t('reportSubmitted'));
        showScreen('home');
      }
    });
  });
  
  // Image Upload with Compression
  document.getElementById('photo-upload').addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      new Compressor(file, {
        quality: 0.6,
        success(compressedResult) {
          alert(i18next.t('imageUploaded'));
        },
        error() {
          alert(i18next.t('imageCompressionError'));
        }
      });
    }
  });
  
  // Voice Input
  function startVoiceInput() {
    if ('SpeechRecognition' in window || 'webkitSpeechRecognition' in window) {
      const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
      recognition.lang = document.getElementById('report-language').value;
      recognition.start();
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        document.getElementById('leak-desc').value = transcript;
      };
      recognition.onerror = () => {
        alert(i18next.t('voiceInputError'));
      };
    } else {
      alert(i18next.t('voiceInputNotSupported'));
    }
  }
  
  // Verify Leak
  function verifyLeak(isConfirmed) {
    document.getElementById('leak-status').textContent = isConfirmed ? 'Confirmed' : 'False';
    alert(i18next.t(isConfirmed ? 'leakConfirmed' : 'leakMarkedFalse'));
  }
  
  // Share Achievement
  function shareAchievement() {
    if (navigator.share) {
      navigator.share({
        title: i18next.t('aquaHero'),
        text: i18next.t('shareAchievement'),
        url: window.location.href
      });
    } else {
      alert('Sharing not supported on this device.');
    }
  }
  
  // Profile Management
  let userProfile = {
    name: 'Aqua User',
    email: 'aquauser@example.com',
    bio: 'Iâ€™m passionate about water conservation and helping my community reduce water waste!',
    location: 'Not Set',
    waterSaved: '500L',
    points: '150',
    reports: '5',
    verifications: '3',
    joined: 'January 2025',
    language: 'English',
    favoriteTip: 'Fix dripping faucets to save up to 15L per day!',
    emailNotifications: 'Enabled',
    pushNotifications: 'Enabled'
  };
  
  function updateProfileDisplay() {
    try {
      document.getElementById('user-name').textContent = userProfile.name;
      document.getElementById('user-email').textContent = userProfile.email;
      document.getElementById('user-location').textContent = `Location: ${userProfile.location}`;
      document.getElementById('user-bio').textContent = userProfile.bio;
      document.getElementById('user-water-saved').textContent = userProfile.waterSaved;
      document.getElementById('user-points').textContent = userProfile.points;
      document.getElementById('user-reports').textContent = userProfile.reports;
      document.getElementById('user-verifications').textContent = userProfile.verifications;
      document.getElementById('user-joined').textContent = userProfile.joined;
      document.getElementById('user-language').textContent = userProfile.language;
      document.getElementById('user-favorite-tip').textContent = userProfile.favoriteTip;
      document.getElementById('user-email-notifications').textContent = userProfile.emailNotifications;
      document.getElementById('user-push-notifications').textContent = userProfile.pushNotifications;
    } catch (error) {
      console.error('Error updating profile display:', error);
    }
  }
  
  function toggleEditProfile() {
    const profileDetails = document.querySelector('.profile-details');
    profileDetails.classList.toggle('editing');
    if (profileDetails.classList.contains('editing')) {
      document.getElementById('edit-user-name').value = userProfile.name;
      document.getElementById('edit-bio').value = userProfile.bio;
    }
  }
  
  function saveProfile() {
    userProfile.name = document.getElementById('edit-user-name').value;
    userProfile.bio = document.getElementById('edit-bio').value;
    updateProfileDisplay();
    toggleEditProfile();
    alert(i18next.t('profileSaved'));
  }
  
  // Contact Form Submission
  function submitContactForm() {
    const name = document.getElementById('contact-name').value;
    const email = document.getElementById('contact-email').value;
    const message = document.getElementById('contact-message').value;
    if (name && email && message) {
      alert(i18next.t('messageSent'));
      showScreen('home');
    } else {
      alert('Please fill out all fields.');
    }
  }
  
  // Save Settings
  function saveSettings() {
    try {
      userProfile.language = document.getElementById('settings-language').value;
      changeLanguage(userProfile.language);
      const theme = document.getElementById('settings-theme').value;
      document.body.setAttribute('data-theme', theme);
      localStorage.setItem('theme', theme);
      document.getElementById('theme-toggle').textContent = theme === 'light' ? 'ðŸŒ™' : 'â˜€ï¸';
      userProfile.emailNotifications = document.getElementById('email-notifications').checked ? 'Enabled' : 'Disabled';
      userProfile.pushNotifications = document.getElementById('push-notifications').checked ? 'Enabled' : 'Disabled';
      setBandwidthMode();
      updateProfileDisplay();
      alert(i18next.t('settingsSaved'));
    } catch (error) {
      console.error('Error saving settings:', error);
    }
  }
  
  // Logout
  function logout() {
    alert('Logged out successfully!');
    showScreen('home');
  }
  
  // Initialize on Load
  document.addEventListener('DOMContentLoaded', () => {
    try {
      applySavedTheme();
      initMaps();
      updateContent();
      showScreen('home');
  
      // Check for nearby leaks
      getUserLocation((coords) => {
        if (coords) {
          const message = i18next.t('leakNearbyBody', { lat: coords.lat, lng: coords.lng });
          if (Notification.permission === 'granted') {
            new Notification(i18next.t('nearbyLeak'), { body: message });
          } else if (Notification.permission !== 'denied') {
            Notification.requestPermission().then(permission => {
              if (permission === 'granted') {
                new Notification(i18next.t('nearbyLeak'), { body: message });
              }
            });
          }
        }
      });
    } catch (error) {
      console.error('Error during initialization:', error);
    }
  });
  
  // Service Worker Registration
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
      navigator.serviceWorker.register('/sw.js').catch(error => {
        console.error('Service Worker registration failed:', error);
      });
    });
  }